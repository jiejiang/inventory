'use strict';window.postOrdersApp=angular.module('postOrdersApp',['ngRoute','restangular','ui.bootstrap','ngFileUpload']).config(['$interpolateProvider',function($interpolateProvider){$interpolateProvider.startSymbol('{[');$interpolateProvider.endSymbol(']}');}]).config(['$routeProvider','RestangularProvider',function($routeProvider,RestangularProvider){RestangularProvider.setBaseUrl(angular.element('body').attr('api_prefix'));var partialsDir='static/partials/';$routeProvider.when('/batch-order',{templateUrl:partialsDir+'batch-order.html',controller:'BatchOrder'}).when('/new-order-numbers',{templateUrl:partialsDir+'new-order-numbers.html',controller:'NewOrderNumbers'}).otherwise({redirectTo:'/batch-order'});}]);$(function(){$('#side-menu').metisMenu();});'use strict';postOrdersApp.controller('Frame',['$scope','$location','$window','$filter','$log',function($scope,$location,$window,$filter,$log){$scope.alerts=[];$scope.addAlert=function(message){$scope.alerts.push({type:'danger',msg:message});};$scope.closeAlert=function(index){$scope.alerts.splice(index,1);};$scope.clearAlerts=function(){$scope.alerts.length=0;};$scope.isActive=function(route){return $location.path().match("^"+route);}
$scope.api_prefix=angular.element('body').attr('api_prefix');$scope.route_prefix=angular.element('body').attr('route_prefix');}]);'use strict';postOrdersApp.controller('BatchOrder',['$scope','Upload','BatchOrderJob','$location','$timeout','$window','$log','Restangular',function($scope,Upload,BatchOrderJob,$location,$timeout,$window,$log,Restangular){$scope.job=BatchOrderJob;$scope.hrefs=['/'+$scope.$parent.route_prefix+'/admin/admin.unused_standard_order','/'+$scope.$parent.route_prefix+'/admin/admin.unused_fast_track_order'];$scope.query_stats=function(){Restangular.one('orders').get().then(function(data){$scope.stats=data.stats;$scope.used_count=data.used_count;},function(data){$scope.clearAlerts();$scope.addAlert("Connection error, please refresh the page...");});};$scope.query_stats();$scope.$watch('file',function(){$scope.clearAlerts();$scope.upload($scope.file);});$scope.upload=function(file){if(file!=undefined){$scope.job.clear();(function(){$scope.job.upload_file={name:file.name,percentage:0};Upload.upload({url:$scope.$parent.api_prefix+'/batch-order',file:file,}).progress(function(evt){$scope.job.upload_file.percentage=parseInt(100.0*evt.loaded/evt.total);}).success(function(data,status,headers,config){$scope.job.id=data.id;$scope.job.data={status:'Waiting',percentage:0,};(function tick(){$scope.job.get().then(function(data){$scope.job.setData(data);$log.log($scope.job.order_numbers);if(!data.finished&&$scope.job.id){$timeout(tick,3000);}else{if(!data.success){$scope.addAlert(data.message);}else{}}
$scope.query_stats();},function(data){if($scope.job.id){$scope.clearAlerts();$scope.addAlert("Connection error, retrying...");$timeout(tick,5000);}});})();}).error(function(data){$scope.job.clear();$scope.addAlert(data.message);$scope.query_stats();});})();}};}]);'use strict';postOrdersApp.factory('BatchOrderJob',['Restangular',function(Restangular){return{id:null,upload_file:null,data:null,clear:function(){this.id=null;this.upload_file=null;this.data=null;},get:function(){return Restangular.one('job',this.id).get();},setData:function(data){this.data=data;},};}]);'use strict';postOrdersApp.controller('NewOrderNumbers',['$scope','Upload','$location','$timeout','$window','$log',function($scope,Upload,$location,$timeout,$window,$log){$scope.running=false;$scope.$watch('file',function(){$scope.clearAlerts();$scope.existing_order_numbers=null;$scope.inserted_order_numbers=null;$scope.invalid_order_numbers=null;$scope.running=false;$scope.upload($scope.file);});$scope.upload=function(file){if(file!=undefined){(function(){$scope.upload_file={name:file.name,percentage:0};$scope.running=true;Upload.upload({url:$scope.$parent.api_prefix+'/orders',file:file,}).progress(function(evt){$scope.upload_file.percentage=parseInt(100.0*evt.loaded/evt.total);}).success(function(data,status,headers,config){$scope.inserted_order_numbers=data.inserted_order_numbers;$scope.invalid_order_numbers=data.invalid_order_numbers;$scope.existing_order_numbers=data.existing_order_numbers;$scope.running=false;}).error(function(data){$log.log(data);$scope.addAlert(data.message);$scope.running=false;});})();}};}]);